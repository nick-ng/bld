import"../chunks/NZTpNUN0.js";import{o as Dt}from"../chunks/TiJ0aFaW.js";import{p as wt,f as D,d as i,s as v,r,aX as kt,g as t,t as O,q as Y,b,aY as $,e as c,af as C,c as Mt,K as _t,a as bt}from"../chunks/BXsdZoRn.js";import{s as E}from"../chunks/tSrHTpot.js";import{i as w}from"../chunks/BSxnXCi7.js";import{r as I,s as ht,b as zt}from"../chunks/CxOf_kpF.js";import{s as gt}from"../chunks/DKWmIzXd.js";import{d as Ct}from"../chunks/DW_c6W7d.js";import{s as St}from"../chunks/B4ZuMZme.js";import{a as tt,b as pt}from"../chunks/PBRzJq_N.js";import{D as ft}from"../chunks/CzRjdjXF.js";import{D as Tt,g as Pt}from"../chunks/D6q6ZJHX.js";import{F as yt}from"../chunks/BWL1kDzn.js";import{e as Et}from"../chunks/3SjX1xnl.js";import{a as It,s as qt}from"../chunks/BBUCDAEd.js";import{g as Ft}from"../chunks/BZ9uxqYJ.js";import{b as xt,f as Nt,a as Kt}from"../chunks/9_MIyRC0.js";import{p as Ot}from"../chunks/BgK6pTgv.js";import{p as jt,s as At}from"../chunks/BKtatTih.js";var Jt=async(k,l,o)=>{const s=await l(o.drillLetters,!0);o.afterSubmit("stand-by",s)},Qt=async(k,l,o)=>{const s=await l(o.drillLetters,!1);o.afterSubmit("stand-by",s)},Bt=(k,l)=>{l.drillLetters.every(o=>o.send)?l.drillLetters.forEach(o=>{o.send=!1}):l.drillLetters.forEach(o=>{o.send=!0})},Ht=D('<tr><td class="border border-gray-500 px-1 text-center"><input type="checkbox"/></td><td class="border border-gray-500 px-1 text-center"><span class="uppercase"> </span> <span> </span></td><td class="border border-gray-500 px-1 text-right"><!></td><td class="border border-gray-500 px-1 text-right"><!></td></tr>'),Rt=async(k,l,o)=>{const s=await l(o.drillLetters,!0);o.afterSubmit("stand-by",s)},Ut=async(k,l,o)=>{const s=await l(o.drillLetters,!1);o.afterSubmit("stand-by",s)},Wt=D('<div class="border border-gray-300 p-2 text-center dark:border-gray-500"><div class="mb-2 flex flex-row items-stretch gap-2"><input class="block w-16 text-right" type="number"/> <button class="grow" type="button">Again</button> <button class="grow" type="button"> </button></div> <table class="w-full"><thead><tr><th class="border border-gray-500 px-1 text-center"><input type="checkbox"/></th><th class="border border-gray-500 px-1 text-center" colspan="3">Letter Pair</th></tr></thead><tbody></tbody></table> <div class="mt-2 flex flex-row items-stretch gap-2"><input class="block w-16 text-right" type="number"/> <button class="grow" type="button">Again</button> <button class="grow" type="button"> </button></div></div>');function Yt(k,l){wt(l,!0);const o=()=>It(Nt,"$flashCardStore",s),[s,et]=qt();let M=C(.7),z=Y(()=>Math.max(1e-4,Math.min(1,t(M))));const u=async(m,_=!1)=>{if(m.some(f=>f.send)&&(await Kt(),await Promise.all(m.map(f=>{if(!f.send||f.timeMs<=0)return;const g=xt(f.letterPair,f.flashCardType,o()),S=f.timeMs,K=Math.min(S,g.drillTimeMs)*t(z)+Math.max(S,g.drillTimeMs)*(1-t(z)),x=new FormData;return x.set("type",f.flashCardType),x.set("drillTimeMs",K.toFixed(0)),f.timeMs<15e3?x.set("commConfidence","2"):f.timeMs<5e3&&x.set("commConfidence","3"),Ot(f.letterPair,x,!0)}))),_){const f=m.map(g=>({...g,quizzed:!1,send:!0,timeMs:-1}));m=At(f)}else m=[],Ft("/flash-cards/summary");return localStorage.setItem(ft,JSON.stringify(m)),m};var n=Wt(),j=i(n),q=i(j);I(q),ht(q,"step",.1);var V=v(q,2);V.__click=[Jt,u,l];var P=v(V,2);P.__click=[Qt,u,l];var at=i(P,!0);r(P),r(j);var A=v(j,2),F=i(A),J=i(F),X=i(J),Q=i(X);I(Q),Q.__click=[Bt,l],r(X),kt(),r(J),r(F);var B=v(F);Et(B,21,()=>l.drillLetters,m=>m.letterPair,(m,_,f)=>{const g=Y(()=>xt(t(_).letterPair,t(_).flashCardType,o()));var S=Ht(),K=i(S),x=i(K);I(x),r(K);var Z=v(K),U=i(Z),st=i(U,!0);r(U);var it=v(U,2),lt=i(it,!0);r(it),r(Z);var L=v(Z),ot=i(L);{var vt=e=>{var a=$();O(d=>E(a,d),[()=>(t(_).timeMs/1e3).toFixed(1)]),b(e,a)},nt=e=>{var a=$("-");b(e,a)};w(ot,e=>{t(_).timeMs>0?e(vt):e(nt,!1)})}r(L);var dt=v(L),mt=i(dt);{var ct=e=>{var a=$();O((d,h)=>E(a,`${d??""}â†’${h??""}`),[()=>(t(g).drillTimeMs/1e3).toFixed(0),()=>(Math.min(t(g).drillTimeMs/1e3,t(_).timeMs/1e3)*t(z)+Math.max(t(g).drillTimeMs/1e3,t(_).timeMs/1e3)*(1-t(z))).toFixed(0)]),b(e,a)},ut=e=>{var a=$("-");b(e,a)};w(mt,e=>{t(_).timeMs>0?e(ct):e(ut,!1)})}r(dt),r(S),O(e=>{E(st,t(_).letterPair),E(lt,e)},[()=>jt(t(g).commutator).normalisedCommutator]),tt(x,()=>t(_).send,e=>t(_).send=e),b(m,S)}),r(B),r(A);var G=v(A,2),N=i(G);I(N),ht(N,"step",.1);var H=v(N,2);H.__click=[Rt,u,l];var R=v(H,2);R.__click=[Ut,u,l];var rt=i(R,!0);r(R),r(G),r(n),O((m,_,f)=>{E(at,m),zt(Q,_),E(rt,f)},[()=>l.drillLetters.every(m=>!m.send)?"End Quiz":"Send",()=>l.drillLetters.every(m=>m.send),()=>l.drillLetters.every(m=>!m.send)?"End Quiz":"Send"]),pt(q,()=>t(M),m=>c(M,m)),pt(N,()=>t(M),m=>c(M,m)),b(k,n),Mt(),et()}Ct(["click"]);var Vt=D('<div class="svelte-1atm5i6">No drill in progress</div>'),Xt=(k,l)=>{c(l,"stand-by")},Gt=D('<div class="flex flex-row items-center justify-center gap-2 svelte-1atm5i6"><label class="like-button svelte-1atm5i6"><input type="checkbox" class="svelte-1atm5i6"/> OK</label> <button class="inline-block svelte-1atm5i6" type="button"><span class="hidden lg:inline svelte-1atm5i6">Next (space)</span><span class="lg:hidden svelte-1atm5i6">Next</span></button></div>'),Zt=D('<div class="text-center svelte-1atm5i6"> </div>'),Lt=D("<!> <!>",1),$t=D('<div class="self-stretch lg:hidden svelte-1atm5i6"><button type="button" class="timer-button mb-1 w-full svelte-1atm5i6"><!></button></div>'),te=D('<div class="hidden text-center lg:block svelte-1atm5i6"><p class="svelte-1atm5i6"></p></div> <div><div></div></div>',1),ee=(k,l)=>{for(let o=0;o<t(l).length;o++)t(l)[o].quizzed||(t(l)[o].quizzed=!0,t(l)[o].send=!1,t(l)[o].timeMs=-1);localStorage.setItem(ft,JSON.stringify(t(l)))},ae=D('<button class="mx-auto svelte-1atm5i6"> </button>'),re=D('<div class="flex flex-col justify-between lg:flex-row svelte-1atm5i6"><div class="hidden lg:block svelte-1atm5i6"><table class="svelte-1atm5i6"><tbody class="svelte-1atm5i6"><tr class="svelte-1atm5i6"><td class="svelte-1atm5i6"><label for="drill-corners-visibility" class="svelte-1atm5i6">Corners</label></td><td class="svelte-1atm5i6"><input class="ml-2 svelte-1atm5i6" type="checkbox" id="drill-corners-visibility"/></td></tr><tr class="svelte-1atm5i6"><td class="svelte-1atm5i6"><label for="drill-memo-visibility" class="svelte-1atm5i6">Memo</label></td><td class="svelte-1atm5i6"><input class="ml-2 svelte-1atm5i6" type="checkbox" id="drill-memo-visibility"/></td></tr><tr class="svelte-1atm5i6"><td class="svelte-1atm5i6"><label for="drill-image-visibility" class="svelte-1atm5i6">Image</label></td><td class="svelte-1atm5i6"><input class="ml-2 svelte-1atm5i6" type="checkbox" id="drill-image-visibility"/></td></tr></tbody></table></div> <div class="basis-prose lg:flex lg:flex-row lg:justify-center lg:gap-2 svelte-1atm5i6"><!> <!> <div class="svelte-1atm5i6"><!> <!> <!> <!> <!></div></div> <!></div>');function ke(k,l){wt(l,!0);const o=300;let s=C(_t([])),et=C(!1),M=C(!0),z=C(!0),u=C(0),n=C("stand-by"),j=C(_t(Date.now())),q=C(0),V=C(0),P=Y(()=>t(s).filter(e=>!e.quizzed).length);const at=()=>{t(n)==="stand-by"||t(n)==="review"&&t(P)>0?(c(n,"ready"),c(j,Date.now(),!0)):t(n)==="timing"&&(c(V,Date.now(),!0),t(s)[t(u)].quizzed=!0,t(s)[t(u)].timeMs=t(V)-t(q),localStorage.setItem(ft,JSON.stringify(t(s))))},A=()=>{t(n)==="ready"?Date.now()-t(j)>=o?(c(u,t(s).findIndex(e=>!e.quizzed),!0),c(n,"timing"),c(q,Date.now(),!0)):c(n,"stand-by"):t(n)==="timing"&&c(n,"review")};Dt(()=>{c(s,Pt(),!0),c(u,0);const e=d=>{if(d.key===" "){at();return}},a=d=>{if(d.key===" "){A();return}};return document.addEventListener("keydown",e),document.addEventListener("keyup",a),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",a)}});var F=re(),J=i(F),X=i(J),Q=i(X),B=i(Q),G=v(i(B)),N=i(G);I(N),r(G),r(B);var H=v(B),R=v(i(H)),rt=i(R);I(rt),r(R),r(H);var m=v(H),_=v(i(m)),f=i(_);I(f),r(_),r(m),r(Q),r(X),r(J);var g=v(J,2),S=i(g);{var K=e=>{var a=Vt();b(e,a)};w(S,e=>{t(s).length===0&&e(K)})}var x=v(S,2);{var Z=e=>{Yt(e,{get drillLetters(){return t(s)},afterSubmit:(a,d)=>{c(n,a,!0),d&&c(s,d,!0)}})};w(x,e=>{t(s).length>0&&t(s).every(a=>a.quizzed)&&e(Z)})}var U=v(x,2),st=i(U);{var it=e=>{var a=Gt(),d=i(a),h=i(d);I(h),kt(),r(d);var T=v(d,2);T.__click=[Xt,n],r(a),tt(h,()=>t(s)[t(u)].send,p=>t(s)[t(u)].send=p),b(e,a)};w(st,e=>{t(P)>0&&t(s)[t(u)]?.letterPair&&t(n)==="review"&&e(it)})}var lt=v(st,2);{var L=e=>{var a=Lt(),d=bt(a);{let p=Y(()=>t(n)==="review"),y=Y(()=>t(n)==="review"),W=Y(()=>t(n)==="timing"?"hidden lg:block":"");yt(d,{get letterPair(){return t(s)[t(u)].letterPair},get flashCardType(){return t(s)[t(u)].flashCardType},get showCorners(){return t(p)},get showMemo(){return t(M)},get showCommutator(){return t(y)},get showImage(){return t(z)},get extraClass(){return t(W)}})}var h=v(d,2);{var T=p=>{var y=Zt(),W=i(y);r(y),O(()=>E(W,`Took ${t(s)[t(u)].timeMs/1e3}s`)),b(p,y)};w(h,p=>{t(n)!=="timing"&&p(T)})}b(e,a)};w(lt,e=>{(t(n)==="timing"||t(n)==="review")&&t(s)[t(u)]?.letterPair&&e(L)})}var ot=v(lt,2);{var vt=e=>{var a=$t(),d=i(a);d.__touchstart=at,d.__touchend=A;var h=i(d);{var T=y=>{yt(y,{get letterPair(){return t(s)[t(u)].letterPair},get flashCardType(){return t(s)[t(u)].flashCardType},showCorners:!1,get showMemo(){return t(M)},showCommutator:!1,get showImage(){return t(z)}})},p=y=>{var W=$();W.nodeValue="Hold for 0.3 seconds then release",b(y,W)};w(h,y=>{t(n)==="timing"&&t(s)[t(u)]?.letterPair?y(T):y(p,!1)})}r(d),r(a),b(e,a)};w(ot,e=>{t(n)!=="review"&&t(P)>0&&e(vt)})}var nt=v(ot,2);{var dt=e=>{var a=te(),d=bt(a),h=i(d);h.textContent="Hold space for 0.3 seconds then release",r(d);var T=v(d,2),p=i(T);St(p,`animation-duration: ${o+5}ms;`),r(T),O(()=>{gt(T,1,`${t(n)==="ready"?"border":""} relative h-4`,"svelte-1atm5i6"),gt(p,1,`${t(n)==="ready"?"animate":""} absolute top-0 left-0 h-full bg-red-500`,"svelte-1atm5i6")}),b(e,a)};w(nt,e=>{t(n)!=="timing"&&t(P)>0&&e(dt)})}var mt=v(nt,2);{var ct=e=>{var a=ae();a.__click=[ee,s];var d=i(a);r(a),O(h=>E(d,`End Drill ${h??""}/${t(s).length??""}`),[()=>t(s).filter(h=>h.quizzed).length]),b(e,a)};w(mt,e=>{t(n)!=="timing"&&t(n)!=="ready"&&t(s).some(a=>!a.quizzed)&&e(ct)})}r(U),r(g);var ut=v(g,2);Tt(ut,{extraClass:"hidden lg:block",onMakeDrill:e=>{c(s,e,!0),c(n,"stand-by")}}),r(F),tt(N,()=>t(et),e=>c(et,e)),tt(rt,()=>t(M),e=>c(M,e)),tt(f,()=>t(z),e=>c(z,e)),b(k,F),Mt()}Ct(["click","touchstart","touchend"]);export{ke as component};

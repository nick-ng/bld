import"../chunks/NZTpNUN0.js";import"../chunks/ClKHmSpm.js";import{p as st,f as p,d as a,r as s,b as v,c as ot,t as I,s as T,q as V,g as t,u as kt,e as S,af as J,a as zt,x as K}from"../chunks/BXsdZoRn.js";import{i as X}from"../chunks/BSxnXCi7.js";import{i as qt}from"../chunks/DjWQOtf8.js";import{a as _,s as it,d as rt,b as mt}from"../chunks/BBUCDAEd.js";import{m as Dt,q as G,a as lt,t as Tt,g as pt,i as Lt,p as Pt}from"../chunks/BgK6pTgv.js";import{s as Y}from"../chunks/tSrHTpot.js";import{e as at}from"../chunks/3SjX1xnl.js";import{d as gt}from"../chunks/DW_c6W7d.js";import{p as ht}from"../chunks/CA4IiTv0.js";import{g as _t}from"../chunks/BZ9uxqYJ.js";import{c as bt,a as Ft,g as Qt,f as yt,l as At,b as ft}from"../chunks/9_MIyRC0.js";import{o as W}from"../chunks/CMvIGskt.js";import{u as Mt,h as Rt,b as Ct,i as $t,k as et}from"../chunks/BKtatTih.js";import{D as Et}from"../chunks/D6q6ZJHX.js";import{s as Ot}from"../chunks/CxOf_kpF.js";import{s as vt}from"../chunks/DKWmIzXd.js";import{F as jt}from"../chunks/BWL1kDzn.js";var Bt=p("<div> </div>"),It=async(g,i,e,u,L,f)=>{try{const w=await Ft(),l=Object.values(w).filter(r=>r.memo&&!Ct(r.letterPair,t(i).bufferPiece)&&!$t(r.letterPair,t(i).samePieces)),P=Dt({flashCardArray:l,minStandBy:e().leitnerMinReviewStandBy,minRetired:e().leitnerMinReviewRetired,retiredMaxAgeDays:e().leitnerRetiredMaxAgeDays,sessionNumber:e().flashCardTypes[t(u)].leitnerSession||0});rt(G,P),rt(lt,"leitner"),Tt(),_t(`/quiz?t=${t(u)}`)}catch(w){console.error("Error when making quiz",w)}},Nt=p('<div class="my-1"><button class="block w-full py-2 text-center text-xl leading-none"> </button></div>'),Ut=p('<div><div><h2 class="text-center">Leitner Quiz</h2> <!> <hr/> <h2 class="text-center">Drill</h2> <!></div></div>'),Yt=p('<div class="mx-auto max-w-prose"><!></div>');function Gt(g,i){st(i,!0);const e=()=>_(yt,"$flashCardStore",l),u=()=>_(W,"$optionsStore",l),L=()=>_(bt,"$flashCardStoreStatus",l),f=()=>_(G,"$quizStore",l),w=()=>_(lt,"$quizTypeStore",l),[l,P]=it();let r=ht.url.searchParams.get("t")||"corner",j=V(()=>Qt(r,e()).filter(n=>n.memo||n.commutator||n.image)),x=V(()=>Object.keys(u().flashCardTypes).reduce((n,m)=>{const k=u().flashCardTypes[m],h=t(j).filter(C=>!Ct(C.letterPair,k.bufferPiece)&&!$t(C.letterPair,k.samePieces)),N=h.filter(C=>pt(C.tags).leitnerDeck==="R").length;return n[m]=`${N}/${h.length}`,n},{}));var F=Yt(),Q=a(F);{var b=n=>{var m=Bt(),k=a(m,!0);s(m),I(h=>Y(k,h),[()=>Mt(L().message)]),v(n,m)},y=n=>{var m=Ut(),k=a(m),h=T(a(k),2);at(h,1,()=>Object.keys(u().flashCardTypes),C=>C,(C,U,d,o)=>{const c=V(()=>u().flashCardTypes[t(U)]);var z=Nt(),$=a(z);$.__click=[It,c,u,U,f,w];var A=a($);s($),s(z),I(D=>Y(A,`${t(c).name??""},
							${t(x)[t(U)]??""}, ${D??""}`),[()=>Rt(new Date((t(c).leitnerLastQuizUnix||0)*1e3))]),v(C,z)});var N=T(h,6);Et(N,{onMakeDrill:()=>{_t("/drill")}}),s(k),s(m),v(n,m)};X(Q,n=>{L().status!=="loaded"?n(b):n(y,!1)})}s(F),v(g,F),ot(),P()}gt(["click"]);var Ht=(g,i,e)=>{i(e,"memo")},Jt=p('<td><button type="button"> </button></td>'),Kt=(g,i,e)=>{i(e,"comm")},Vt=p('<td><button type="button"> </button></td>'),Wt=(g,i,e)=>{g.preventDefault(),i(t(e).letterPair)},Xt=p('<div class="absolute bottom-2 left-0 z-1 w-full px-2 lg:relative lg:w-full lg:px-0"><table class="mb-2 w-full border-collapse"><tbody><tr><td class="w-1 pr-1">Memo</td><!></tr><tr><td class="w-1 pr-1">Comm</td><!></tr></tbody></table> <div class="flex flex-row gap-1"><a class="cannot-hover:py-2 block rounded border border-gray-600 px-2 py-0 text-center dark:border-gray-300" style="flex-grow: 2">Edit</a> <div style="flex-grow: 1"></div> <button style="flex-grow: 2" type="button"> </button></div></div>'),Zt=(g,i)=>{S(i,!0)},te=p('<div class="w-full px-2 lg:px-0"><button class="cannot-hover:py-4 block w-full rounded border border-gray-600 px-2 py-0 dark:border-gray-300">Show Answer</button></div>'),ee=p("<!> <!>",1),re=p("<div>Loading</div>"),ae=p('<div class="mx-auto max-w-prose"><!></div>');function se(g,i){st(i,!0);const e=()=>_(G,"$quizStore",l),u=()=>_(yt,"$flashCardStore",l),L=()=>_(lt,"$quizTypeStore",l),f=()=>_(W,"$optionsStore",l),w=()=>_(bt,"$flashCardStoreStatus",l),[l,P]=it();let r=ht.url.searchParams.get("t")||"corner",j=V(()=>ft(e()[0],r,u())),x=J(!1),F=J(!1),Q=null,b=J(-1),y=J(-1);const n=d=>{Q&&Q.abort(),Q=new AbortController,(async()=>{const o=await At(d,r,Q.signal);Q=null,o&&(S(b,o.memoConfidence,!0),S(y,o.commConfidence,!0))})()};kt(()=>{n(e()[0])});const m=async(d,o="memo")=>{switch(o){case"comm":{S(y,d,!0);break}case"memo":default:S(b,d,!0)}},k=async d=>{const o=ft(d,r,u());if(!o)return;S(F,!0);const c=new FormData;if(c.set("type",o.type),c.set("memoConfidence",t(b).toString(10)),c.set("commConfidence",t(y).toString(10)),L()==="leitner"){const z=f().flashCardTypes[r].leitnerSession||0;if(e().length===1&&(mt(W,K(f).flashCardTypes[r].leitnerLastQuizUnix=Date.now()/1e3,K(f)),mt(W,K(f).flashCardTypes[r].leitnerSession=(z+1)%10,K(f))),t(y)>=2&&t(b)>=2){const $=pt(o.tags);if($.leitnerDeck==="S"||$.leitnerDeck==="C")c.set("tags",et(o.tags,"L:",`L:${z}`));else if($.leitnerDeck==="R"||Lt($.leitnerDeck,z)){const A=new Date;c.set("tags",et(o.tags,"L:",`L:R:${A.getFullYear()}-${(A.getMonth()+1).toString().padStart(2,"0")}-${A.getDate().toString().padStart(2,"0")}`))}}else c.set("tags",et(o.tags,"L:","L:C"))}S(y,-1),S(b,-1),S(x,!1),await Pt(d,c),S(F,!1)};var h=ae(),N=a(h);{var C=d=>{var o=ee(),c=zt(o);jt(c,{get letterPair(){return t(j).letterPair},get flashCardType(){return r},get quizLeft(){return e().length},get showCorners(){return t(x)},get showMemo(){return t(x)},get showCommutator(){return t(x)},get showImage(){return t(x)},onQuizEnd:()=>{rt(G,[])},extraClass:"min-h-[50vh] lg:min-h-[460px]"});var z=T(c,2);{var $=D=>{var M=Xt(),B=a(M),nt=a(B),Z=a(nt),St=T(a(Z));at(St,16,()=>[0,1,2,3],R=>R,(R,E)=>{var O=Jt(),q=a(O);q.__click=[Ht,m,E];var tt=a(q,!0);s(q),s(O),I(()=>{vt(q,1,`w-full ${t(b)==E?"bg-blue-300 dark:bg-blue-700":"opaque"}`),Y(tt,E)}),v(R,O)}),s(Z);var dt=T(Z),wt=T(a(dt));at(wt,16,()=>[0,1,2,3],R=>R,(R,E)=>{var O=Vt(),q=a(O);q.__click=[Kt,m,E];var tt=a(q,!0);s(q),s(O),I(()=>{vt(q,1,`w-full ${t(y)==E?"bg-blue-300 dark:bg-blue-700":"opaque"}`),Y(tt,E)}),v(R,O)}),s(dt),s(nt),s(B);var ct=T(B,2),ut=a(ct),H=T(ut,4);H.__click=[Wt,k,j];var xt=a(H);s(H),s(ct),s(M),I(()=>{Ot(ut,"href",`/flash-cards/edit?t=${t(j).type}&lp=${t(j).letterPair}`),H.disabled=t(b)<0||t(y)<0,Y(xt,`Submit ${t(y)>=2&&t(b)>=2?"⭕":"❌"}`)}),v(D,M)},A=D=>{var M=te(),B=a(M);B.__click=[Zt,x],s(M),I(()=>B.disabled=t(F)),v(D,M)};X(z,D=>{t(x)?D($):D(A,!1)})}v(d,o)},U=d=>{var o=re();v(d,o)};X(N,d=>{e().length>0&&w().status==="loaded"?d(C):d(U,!1)})}s(h),v(g,h),ot(),P()}gt(["click"]);var oe=p('<div class="mx-auto max-w-prose"><!></div>');function xe(g,i){st(i,!1);const e=()=>_(G,"$quizStore",u),[u,L]=it();qt();var f=oe(),w=a(f);{var l=r=>{se(r,{})},P=r=>{Gt(r,{})};X(w,r=>{e().length>0?r(l):r(P,!1)})}s(f),v(g,f),ot(),L()}export{xe as component};

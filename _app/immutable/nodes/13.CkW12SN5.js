import{f as $,a as k}from"../chunks/ChvGfjHK.js";import{ad as te,aL as qe,g as e,aJ as Fe,aM as v,b as m,aQ as ie,p as ge,P as _,c as d,r as c,a as _e,t as j,s as S,V as Re,f as Pe,n as We}from"../chunks/C5K1Yg5B.js";import{i as re}from"../chunks/DaHJMf7G.js";import{p as ve}from"../chunks/B5WL_Ogo.js";import{o as Le}from"../chunks/Bk01Ho5O.js";import{s as E}from"../chunks/CliCnMxv.js";import{e as he}from"../chunks/BVS0q2To.js";import{s as Qe}from"../chunks/Bqkc9qf9.js";import{s as K}from"../chunks/DcH0Rxn3.js";import{d as Ne,a as X}from"../chunks/Co33GQ6k.js";import{s as Ie}from"../chunks/CfrceTM-.js";import{a as oe,b as U,s as Te}from"../chunks/Bwczmf3X.js";import{a as je,f as Ee,l as Ce,b as Ke,s as He}from"../chunks/DH80SLoI.js";import{o as M}from"../chunks/CZvxKhKB.js";import{i as Ve,u as Je,b as De,m as Ye}from"../chunks/B_Hhx7_u.js";import{g as pe}from"../chunks/ChY-GE9O.js";import{L as Xe}from"../chunks/C_7VeXfQ.js";var Me=!1;class ne extends Date{#e=te(super.getTime());#s=new Map;#t=qe;constructor(...t){super(...t),Me||this.#r()}#r(){Me=!0;var t=ne.prototype,s=Date.prototype,r=Object.getOwnPropertyNames(s);for(const n of r)(n.startsWith("get")||n.startsWith("to")||n==="valueOf")&&(t[n]=function(...a){if(a.length>0)return e(this.#e),s[n].apply(this,a);var o=this.#s.get(n);if(o===void 0){const u=qe;Fe(this.#t),o=v(()=>(e(this.#e),s[n].apply(this,a))),this.#s.set(n,o),Fe(u)}return e(o)}),n.startsWith("set")&&(t[n]=function(...a){var o=s[n].apply(this,a);return m(this.#e,s.getTime.call(this)),o})}}const Ze=Symbol();class Ue extends URLSearchParams{#e=te(0);#s=et();#t=!1;#r(){if(!this.#s||this.#t)return;this.#t=!0;const t=this.toString();this.#s.search=t&&`?${t}`,this.#t=!1}[Ze](t){if(!this.#t){this.#t=!0;for(const s of[...super.keys()])super.delete(s);for(const[s,r]of t)super.append(s,r);ie(this.#e),this.#t=!1}}append(t,s){super.append(t,s),this.#r(),ie(this.#e)}delete(t,s){var r=super.has(t,s);super.delete(t,s),r&&(this.#r(),ie(this.#e))}get(t){return e(this.#e),super.get(t)}getAll(t){return e(this.#e),super.getAll(t)}has(t,s){return e(this.#e),super.has(t,s)}keys(){return e(this.#e),super.keys()}set(t,s){var r=super.getAll(t).join("");super.set(t,s),r!==super.getAll(t).join("")&&(this.#r(),ie(this.#e))}sort(){super.sort(),this.#r(),ie(this.#e)}toString(){return e(this.#e),super.toString()}values(){return e(this.#e),super.values()}entries(){return e(this.#e),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return e(this.#e),super.size}}let Ge=null;function et(){return Ge}function tt(i,t,s){return i==="memo"?{hideWords:t,hideImage:t,selectedBuffers:[]}:{hideWords:!s.showImagesForAlgs,hideImage:!s.showImagesForAlgs,selectedBuffers:t?[]:[i]}}function I(i,t){const s={sm2_n:0,sm2_ef:2.5,sm2_i:0};switch(i){case"orozco-edges":{const r=o=>o?.algorithms?.UF?.next_review_at||new Date,n=o=>o.algorithms?.UF||s,a=o=>(o.speffz_pair.includes("a")||o.speffz_pair.includes("q"))&&o?.algorithms?.UF?.moves?.length>2;return{category:i,subcategory:null,filterFunc:a,getNextReview:r,getNextLetters:Q(a,r),getSMStats:n,title:"Orozco, Edges",quizType:"alg",sortString:"zz-orozco-edges"}}case"orozco-corners":{const r=o=>o?.algorithms?.UFR?.next_review_at||new Date,n=o=>o.algorithms?.UFR||s,a=o=>o.speffz_pair.includes("b")&&o?.algorithms?.UFR?.moves?.length>2;return{category:i,subcategory:null,filterFunc:a,getNextReview:r,getNextLetters:Q(a,r),getSMStats:n,title:"Orozco, Corners",quizType:"alg",sortString:"zz-orozco-corners"}}case"UF":{const r=a=>a?.algorithms?.[i]?.next_review_at||new Date,n=a=>a.algorithms?.[i]||s;switch(t){case"algorithm":{const a=o=>o?.algorithms?.UF?.moves?.length>2&&!(o?.algorithms?.[i]?.moves?.includes(",")||o?.algorithms?.[i]?.moves?.includes("/"));return{category:i,subcategory:t||null,filterFunc:a,getNextReview:r,getNextLetters:Q(a,r),getSMStats:n,title:`${i} Buffer, Algorithms`,quizType:"alg",sortString:"UF !algorithms"}}default:{if(t?.length===2&&t.includes("*")){const o=t[1]==="*",u=h=>(o?h.speffz_pair.startsWith(t[0]):h.speffz_pair.endsWith(t[1]))&&h?.algorithms?.[i]?.moves?.length>2;return{category:i,subcategory:t||null,filterFunc:u,getNextReview:r,getNextLetters:Q(u,r),getSMStats:n,title:`${i} Buffer, ${t.toUpperCase()}`,quizType:"alg",sortString:`${i} Buffer, ${t.toUpperCase()}`}}const a=o=>o?.algorithms?.[i]?.moves?.length>2;return{category:i,subcategory:t||null,filterFunc:a,getNextReview:r,getNextLetters:Q(a,r),getSMStats:n,title:`${i} Buffer`,quizType:"alg",sortString:`${i} !!`}}}}case"UFR":{const r=a=>a?.algorithms?.[i]?.next_review_at||new Date,n=a=>a.algorithms?.[i]||s;switch(t){default:{if(t?.length===2&&t.includes("*")){const o=t[1]==="*",u=h=>(o?h.speffz_pair.startsWith(t[0]):h.speffz_pair.endsWith(t[1]))&&h?.algorithms?.[i]?.moves?.length>2;return{category:i,subcategory:t||null,filterFunc:u,getNextReview:r,getNextLetters:Q(u,r),getSMStats:n,title:`${i} Buffer, ${t.toUpperCase()}`,quizType:"alg",sortString:`${i} Buffer, ${t.toUpperCase()}`}}const a=o=>o?.algorithms?.[i]?.moves?.length>2;return{category:i,subcategory:t||null,filterFunc:a,getNextReview:r,getNextLetters:Q(a,r),getSMStats:n,title:`${i} Buffer`,quizType:"alg",sortString:`${i} !!`}}}}default:{const r=a=>a.next_review_at,n=a=>a||s;{const a=(t||"").split(","),o=u=>(u.words.length>0||u.image.length>0)&&Ve(u.speffz_pair,a);return{category:i,subcategory:t||null,filterFunc:o,getNextReview:r,getNextLetters:Q(o,r),getSMStats:n,title:"Images",quizType:"memo",sortString:"!Images"}}}}}function Q(i,t){return(s,r=3)=>{const n=new Date,a={};return s.filter(u=>t(u)<=n&&i(u)).sort((u,h)=>(a[u.speffz_pair]||(a[u.speffz_pair]=t(u).valueOf()+Math.random()*r*36e5+1),a[h.speffz_pair]||(a[h.speffz_pair]=t(h).valueOf()+Math.random()*r*36e5+1),a[u.speffz_pair]-a[h.speffz_pair]))}}const rt=1440*60*1e3,st=480*60*1e3;function at(i,t,s=-1){const r={sm2_n:t.sm2_n,sm2_ef:t.sm2_ef,sm2_i:t.sm2_i,last_review_at:new Date,next_review_at:new Date};if(i>=3?(t.sm2_n===0?r.sm2_i=1:t.sm2_n===1?r.sm2_i=6:r.sm2_i=Math.round(t.sm2_i*t.sm2_ef),r.sm2_n=Math.round(t.sm2_n+1),r.next_review_at=new Date(Date.now()+r.sm2_i*rt-st)):(r.sm2_n=0,r.sm2_i=.5),r.sm2_ef=t.sm2_ef+(.1-(5-i)*(.08+(5-i)*.02)),r.sm2_ef<1.3)r.sm2_ef=1.3;else if(s>0&&i===5&&r.sm2_ef<s){const n=.1*((r.sm2_ef-1.3)/(s-1.3));r.sm2_ef=r.sm2_ef+n}return r}var it=$("<div> </div>"),ot=$('<div><a> </a> <details class="hidden lg:block"><summary class="like-button py-2">ğŸ”</summary> <div class="like-button absolute top-[calc(100%+0.25rem)] right-0 z-1 bg-white p-2 text-left uppercase"> </div></details> <button type="button">ğŸ“Œ</button></div>'),nt=$('<div><div class="align-center mt-5 mb-2 flex flex-col items-end gap-2"><button>Reload</button> <!></div></div>'),lt=$('<div class="mx-auto max-w-prose"><!></div>');function ut(i,t){ge(t,!0);const s=()=>oe(M,"$optionsStore",a),r=()=>oe(Ce,"$letterPairStore",a),n=()=>oe(je,"$letterPairStoreStatus",a),[a,o]=Te(),u=1e3*60*60*24;let h=v(()=>[I("memo",De(s().chosenBuffers).join(",")),...De(s().chosenBuffers).map(f=>{const l=v(()=>Object.values(r()).reduce((b,g)=>(b.add(g.speffz_pair[0]),b),new Set));return[I(f,null),...[...e(l)].map(b=>I(f,`${b}*`))]}),I("orozco-edges",null),I("orozco-corners",null),I("UF","algorithm")].flat().map(f=>({...f,all:Object.values(r()).filter(f.filterFunc)})).filter(f=>f.all.length>0).sort((f,l)=>f.sortString.localeCompare(l.sortString)));const L=(f,l,b)=>{if(b.length===0)return"";const g=new Ue;return g.set("sp",b[0].speffz_pair),g.set("category",f),l&&g.set("subcategory",l),`/quiz?${g.toString()}`};Le(()=>{const f=new ne;f.setHours(5,0,0,0);const l=f.valueOf();s().newCardDay+u<l&&(U(M,_(s).newCardDay=l,_(s)),U(M,_(s).newCardsToday=0,_(s)))});var H=lt(),le=d(H);{var ue=f=>{var l=it(),b=d(l,!0);c(l),j(g=>E(b,g),[()=>Je(n().message)]),k(f,l)},se=f=>{var l=nt(),b=d(l),g=d(b),T=S(g,2);he(T,17,()=>e(h),N=>`${N.category}-${N.subcategory||"*"}`,(N,w)=>{const O=v(()=>I(e(w).category,e(w).subcategory)),Z=v(()=>`${e(O).category}-${e(O).subcategory||"*"}`),ae=v(()=>s().pinnedQuizzes.includes(e(Z))),G=v(()=>e(O).getNextLetters(Object.values(r())));var A=ot(),B=d(A),fe=d(B);c(B);var p=S(B,2),z=S(d(p),2),R=d(z,!0);c(z),c(p);var C=S(p,2);c(A),j((F,ee)=>{K(A,1,`${e(w).category!=="memo"&&e(w).subcategory?"w-9/10":"w-full"} group relative flex flex-row gap-1`),Ie(A,`order: ${(e(G).length===0?15:10)-(e(ae)?10:0)};`),K(B,1,`${e(G).length===0?"bg-emerald-100":""} like-button block grow py-2 text-center text-xl leading-none`),Qe(B,"href",F),E(fe,`${e(O).title??""} (${e(G).length??""}/${e(w).all.length??""} due)`),E(R,ee),K(C,1,`${e(ae)?"bg-blue-100":""}`)},[()=>L(e(w).category,e(w).subcategory,e(G)),()=>e(w).all.map(F=>F.speffz_pair).sort().join(", ")]),X("click",C,()=>{e(ae)?U(M,_(s).pinnedQuizzes=s().pinnedQuizzes.filter(F=>F!==e(Z)),_(s)):U(M,_(s).pinnedQuizzes=[...s().pinnedQuizzes,e(Z)],_(s))}),k(N,A)}),c(b),c(l),j(()=>{K(g,1,`self-start ${n().status!=="loaded"?"bg-slate-200":""}`),g.disabled=n().status!=="loaded"}),X("click",g,()=>{if(n().status!=="loaded")return;Ee();const N=new ne;N.setHours(5,0,0,0);const w=N.valueOf();s().newCardDay+u<w&&(U(M,_(s).newCardDay=w,_(s)),U(M,_(s).newCardsToday=0,_(s)))}),k(f,l)};re(le,f=>{n().status!=="loaded"&&n().status!=="reloading"&&n().status!=="saving"?f(ue):f(se,!1)})}c(H),k(i,H),_e(),o()}Ne(["click"]);var ft=$('<div>All done! Back to <a href="/quiz">Quiz</a></div>'),ct=$("<h3>Loading...</h3>"),dt=$('<div class="mx-1 mb-3 flex flex-row gap-1"><button type="button">Done</button> <button type="button">Submit</button></div>'),mt=$('<td><button type="button"> </button></td>'),vt=$('<td><button type="button"> </button></td>'),pt=$('<!> <table class="mb-3 w-full border-collapse border-separate border-spacing-1"><tbody><tr></tr><tr></tr></tbody></table>',1),ht=$('<div class="relative"><div class="absolute top-0 left-0 grid grid-cols-2 gap-x-1"><div>Left:</div> <div> </div></div> <h3 class="text-center"> </h3> <div class="absolute top-0 right-0"><a class="like-button" href="/quiz">End Quiz</a></div></div> <!> <div class="cannot-hover:absolute cannot-hover:bottom-6 cannot-hover:left-0 cannot-hover:px-2 z-1 mt-1 flex w-full flex-col"><!> <div class="mx-1"><button class="block w-full rounded border border-gray-600 px-2 dark:border-gray-300">Show Answer</button></div></div>',1),gt=$('<div class="mx-auto max-w-prose"><!> <details class="can-hover:block hidden"><summary>Debug</summary> <pre> </pre></details></div>');function _t(i,t){ge(t,!0);const s=()=>oe(Ce,"$letterPairStore",n),r=()=>oe(M,"$optionsStore",n),[n,a]=Te(),o=1e3*60*60*24;let u=v(()=>I(t.category,t.subcategory)),h=v(()=>e(u).title),L=v(()=>e(u).quizType),H=v(()=>e(u).getSMStats),le=v(()=>e(u).getNextLetters),ue=v(()=>e(u).filterFunc),se=v(()=>e(u).getNextReview),f=te(!0),l=te(-1),b=v(()=>s()[t.currentSpeffzPair]),g=v(()=>e(le)(Object.values(s())).filter(p=>r().newCardsToday<r().maxNewCardsPerDay?!0:e(H)(p).sm2_i>.2)),T=te(!1),N=te(Re(Date.now()));const w=async(p=!1)=>{if(e(f)||e(l)<0)return;m(T,!0);let z=t.category;t.category==="orozco-edges"?z="UF":t.category==="orozco-corners"&&(z="UFR"),m(N,Date.now(),!0);const R=e(H)(e(b)),C=at(e(l),R,r().targetEf);switch(e(L)){case"alg":{await He({speffz_pair:t.currentSpeffzPair,buffer:z,...C},!0);break}case"memo":{await Ke({speffz_pair:t.currentSpeffzPair,...C},!0);break}default:{console.error("unexpected quiz type"),m(T,!1);return}}const F=new ne;F.setHours(5,0,0,0);const ee=F.valueOf();if(r().newCardDay+o<ee&&(U(M,_(r).newCardDay=ee,_(r)),U(M,_(r).newCardsToday=0,_(r))),R.sm2_i<.2&&U(M,_(r).newCardsToday=r().newCardsToday+1,_(r)),m(T,!1),p){m(l,-1),pe("/quiz");return}if(e(g).length===0){const V=Object.values(s()).filter(J=>e(ue)(J)?r().newCardsToday<r().maxNewCardsPerDay?!0:e(H)(J).sm2_i>.2:!1).sort((J,de)=>e(se)(J).valueOf()-e(se)(de).valueOf()),ce=e(se)(V[0]).valueOf()-Date.now();alert(`All done! Next card in ${Ye(ce)}`),pe("/quiz");return}m(f,!0),m(l,-1),setTimeout(()=>{const V=new Ue(location.search);V.set("sp",e(g)[0].speffz_pair),pe(`/quiz?${V.toString()}`)},0)};Le(()=>{const p=z=>{switch(z.key){case"1":{m(l,0);break}case"2":{m(l,1);break}case"3":{m(l,2);break}case"4":{m(l,3);break}case"5":{m(l,4);break}case"6":{m(l,5);break}case" ":{m(f,!1);break}case"Enter":{w(!1);break}default:console.info("unhandled key pressed",z.key)}};return document.addEventListener("keypress",p),()=>{document.removeEventListener("keypress",p)}});var O=gt(),Z=d(O);{var ae=p=>{var z=ft();k(p,z)},G=p=>{var z=ht(),R=Pe(z),C=d(R),F=S(d(C),2),ee=d(F,!0);c(F),c(C);var V=S(C,2),ce=d(V);c(V),We(2),c(R);var J=S(R,2);{var de=x=>{const W=v(()=>tt(t.category,e(f),r()));Xe(x,{get letterPair(){return e(b)},get selectedBuffers(){return e(W).selectedBuffers},get hideWords(){return e(W).hideWords},get hideImage(){return e(W).hideImage},isQuiz:!0})},Oe=x=>{var W=ct();k(x,W)};re(J,x=>{e(b)?x(de):x(Oe,!1)})}var be=S(J,2),we=d(be);{var Ae=x=>{var W=pt(),xe=Pe(W);{var Be=P=>{var D=dt(),q=d(D),y=S(q,2);c(D),j(()=>{K(q,1,`grow ${e(T)?"bg-slate-200":"bg-white"}`),q.disabled=e(T)||e(l)<0,K(y,1,`grow ${e(T)?"bg-slate-200":"bg-white"}`),y.disabled=e(T)||e(l)<0}),X("click",q,async Y=>{Y.preventDefault(),await w(!0)}),X("click",y,async Y=>{Y.preventDefault(),await w(!1)}),k(P,D)};re(xe,P=>{e(l)>=0&&P(Be)})}var ye=S(xe,2),ke=d(ye),me=d(ke);he(me,20,()=>[{label:"Nothing",q:0},{label:"Familiar",q:1},{label:"3",q:2}],P=>P.q,(P,D)=>{var q=mt(),y=d(q),Y=d(y);c(y),c(q),j(()=>{K(y,1,`w-full ${e(l)==D.q?"bg-blue-300 dark:bg-blue-700":"opaque"}`),E(Y,`âŒ ${D.label??""}`)}),X("click",y,()=>{m(l,D.q,!0)}),k(P,q)}),c(me);var $e=S(me);he($e,20,()=>[{label:"Effort",q:3},{label:"Hesitation",q:4},{label:"Perfect",q:5}],P=>P.q,(P,D)=>{var q=vt(),y=d(q),Y=d(y);c(y),c(q),j(()=>{K(y,1,`w-full ${e(l)==D.q?"bg-blue-300 dark:bg-blue-700":"opaque"}`),E(Y,`â­• ${D.label??""}`)}),X("click",y,()=>{m(l,D.q,!0)}),k(P,q)}),c($e),c(ke),c(ye),k(x,W)};re(we,x=>{e(f)||x(Ae)})}var ze=S(we,2),Se=d(ze);c(ze),c(be),j(()=>{E(ee,e(g).length),E(ce,`Quiz: ${e(h)??""}`),Se.disabled=!e(f)}),X("click",Se,()=>{m(f,!1);const x=Date.now()-e(N);x<(r().auto5s||2)*1e3?m(l,5):x<(r().auto4s||7)*1e3&&m(l,4)}),k(p,z)};re(Z,p=>{e(g).length===0?p(ae):p(G,!1)})}var A=S(Z,2),B=S(d(A),2),fe=d(B,!0);c(B),c(A),c(O),j(p=>E(fe,p),[()=>JSON.stringify(e(b),null,2)]),k(i,O),_e(),a()}Ne(["click"]);var bt=$('<div class="mx-auto max-w-prose"><!></div>');function Ot(i,t){ge(t,!0);let s=v(()=>ve.url.searchParams.get("sp")),r=v(()=>ve.url.searchParams.get("category")),n=v(()=>ve.url.searchParams.get("subcategory"));var a=bt(),o=d(a);{var u=L=>{_t(L,{get currentSpeffzPair(){return e(s)},get category(){return e(r)},get subcategory(){return e(n)}})},h=L=>{ut(L,{})};re(o,L=>{e(s)&&e(r)?L(u):L(h,!1)})}c(a),k(i,a),_e()}export{Ot as component};

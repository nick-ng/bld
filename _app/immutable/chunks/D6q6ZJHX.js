import"./NZTpNUN0.js";import{p as se,f as T,af as L,q as M,s as y,d as D,t as E,b as C,c as le,e as m,g as e,r as w,o as oe,a as ie}from"./BXsdZoRn.js";import{s as W}from"./tSrHTpot.js";import{i as F}from"./BSxnXCi7.js";import{e as j}from"./3SjX1xnl.js";import{r as ne}from"./CxOf_kpF.js";import{s as ce}from"./DKWmIzXd.js";import{d as ue}from"./DW_c6W7d.js";import{b as fe}from"./PBRzJq_N.js";import{i as de,s as me,b as pe}from"./Bp8cT6v5.js";import{s as _e,a as ve}from"./BBUCDAEd.js";import{p as he}from"./CA4IiTv0.js";import{g as B,f as Y,a as ge}from"./9_MIyRC0.js";import{z as x,o as be}from"./CMvIGskt.js";import{g as J}from"./COnQFo7S.js";import{D as Z,S as ke}from"./CzRjdjXF.js";import{g as Se}from"./BgK6pTgv.js";import{i as ye,b as we,p as A,s as N,c as xe}from"./BKtatTih.js";const Re=x.object({letterPair:x.string(),flashCardType:x.string(),quizzed:x.boolean(),send:x.boolean(),timeMs:x.number()}),De=x.array(Re),et=()=>{try{const o=localStorage.getItem(Z);if(!o)return[];const r=JSON.parse(o),a=De.safeParse(r);if(a.success)return a.data}catch(o){console.info("error parsing stored drill items",o)}return[]},G=(o,r)=>{const a=B(o,r),p=new Set;for(let i=0;i<a.length;i++){const u=A(a[i].commutator);u.interchange&&p.add(u.interchange[0])}return[{key:"slow",filters:["all","retired"],defaultSize:5,label:"Slow"},{key:"old",filters:["all","retired"],defaultSize:5,label:"Old"},{key:"starts-with",filters:ke,defaultSize:-1,label:"Starts with"},{key:"insert",filters:["3-move","4-move","full-domino","half-domino"],defaultSize:-1,label:"Insert type"},{key:"interchange",filters:[...p,"slash"].sort((i,u)=>i.localeCompare(u)),defaultSize:-1,label:"Interchange"},{key:"random",filters:["all","retired"],defaultSize:5,label:"Random"}]},H=(o,r,a,p)=>{const i=J(Y),f=G(r,i).find(t=>t.key===o);if(!f)return[];let l=B(r,i);const b=J(be).flashCardTypes[r];b&&(l=l.filter(t=>!(ye(t.letterPair,b.samePieces)||we(t.letterPair,b.bufferPiece))));let s=[],k=[];switch(a){case"all":{s=l;break}case"retired":{s=l.filter(t=>Se(t.tags).leitnerDeck==="R");break}default:switch(f.key){case"starts-with":{s=l.filter(t=>t.letterPair.toLowerCase().startsWith(a.toLowerCase()));break}case"interchange":{a==="slash"?s=l.filter(t=>t.commutator.includes("/")):s=l.filter(t=>A(t.commutator).interchange.startsWith(a));break}case"insert":{s=l.filter(t=>{const n=A(t.commutator);switch(a){case"3-move":return n.insertLength===3;case"4-move":return n.insertLength===4;case"full-domino":{const h=n.insert.replaceAll("'","");return h==="R2 U R2 U R2"||h==="R2 D R2 D R2"}case"half-domino":{const h=n.insert.replaceAll("'","");return h==="R D R U R D R"||h==="R U R D R U R"}}return n.interchange.startsWith(a)});break}default:s=l}}switch(f.key){case"slow":{s.sort((t,n)=>{const h=Math.round(t.drillTimeMs/1e3),z=Math.round(n.drillTimeMs/1e3);return h!==z?z-h:t.commConfidence-n.commConfidence});break}case"old":{s.sort((t,n)=>t.lastDrillUnix-n.lastDrillUnix);break}case"random":default:s=N(s)}f.defaultSize<=0?k=s:k=s.slice(0,p);const R=N(k.map(t=>({letterPair:t.letterPair,flashCardType:r,quizzed:!1,send:!0,timeMs:-1})));return localStorage.setItem(Z,JSON.stringify(R)),R};var Ce=(o,r,a,p,i,u)=>{m(r,o.currentTarget.value,!0),m(a,e(p).find(f=>f.key===e(r))||null,!0),e(a)&&(m(i,e(a).filters[0],!0),m(u,e(a).defaultSize,!0))},ze=T("<option> </option>"),Pe=T("<option> </option>"),Te=T('<select class="block px-1 py-1 capitalize lg:py-0"></select>'),Le=(o,r)=>{m(r,e(r)-1)},Me=(o,r)=>{m(r,e(r)+1)},Ie=T('<div class="flex flex-row gap-1"><button type="button" class="px-4 lg:hidden">-1</button> <input class="block w-16 shrink grow basis-1 text-right" type="number"/> <button type="button" class="px-4 lg:hidden">+1</button></div>'),Ue=async(o,r,a,p,i,u,f)=>{await ge();const l=H(e(r),e(a),e(p),e(i));m(r,"none"),m(u,null),m(p,""),m(i,0),typeof f.onMakeDrill=="function"&&f.onMakeDrill(l)},Ee=T('<div><div class="flex flex-col gap-y-1 lg:flex-row lg:gap-2"><label class="hidden lg:block" for="drillSetSelect">Drill Set:</label> <select id="drillSetSelect" class="block px-1 py-1 lg:py-0"><option>Choose a set</option><!></select> <!> <!></div> <button class="py-2 text-xl leading-none" type="button">Start Drill</button></div>');function tt(o,r){se(r,!0);const a=()=>ve(Y,"$flashCardStore",p),[p,i]=_e();let u=M(()=>he.url.searchParams.get("t")||"corner"),f=M(()=>G(e(u),a())),l=L("none"),v=L(null),b=L(""),s=L(0);var k=Ee(),R=D(k),t=y(D(R),2);t.__change=[Ce,l,v,f,b,s];var n=D(t);n.value=n.__value="none";var h=y(n);j(h,17,()=>e(f),_=>_.key,(_,d)=>{var c=ze(),g=D(c,!0);w(c);var S={};E(()=>{W(g,e(d).label),S!==(S=e(d).key)&&(c.value=(c.__value=e(d).key)??"")}),C(_,c)}),w(t);var z;de(t);var O=y(t,2);{var K=_=>{var d=Te();j(d,20,()=>e(v).filters,c=>c,(c,g)=>{const S=M(()=>H(e(l),e(u),g,e(s)).length),I=M(()=>e(v).defaultSize>0?"":` (${e(S)})`);var $=oe(),ee=ie($);{var te=U=>{var P=Pe(),re=D(P);w(P);var q={};E(ae=>{W(re,`${ae??""}${e(I)??""}`),q!==(q=g)&&(P.value=(P.__value=g)??"")},[()=>xe(g.replaceAll("-"," "))]),C(U,P)};F(ee,U=>{(e(v).defaultSize>0||e(S)>0)&&U(te)})}C(c,$)}),w(d),pe(d,()=>e(b),c=>m(b,c)),C(_,d)};F(O,_=>{e(v)&&e(v).filters.length>1&&_(K)})}var Q=y(O,2);{var V=_=>{var d=Ie(),c=D(d);c.__click=[Le,s];var g=y(c,2);ne(g);var S=y(g,2);S.__click=[Me,s],w(d),fe(g,()=>e(s),I=>m(s,I)),C(_,d)};F(Q,_=>{e(v)&&e(v).defaultSize>0&&_(V)})}w(R);var X=y(R,2);X.__click=[Ue,l,u,b,s,v,r],w(k),E(()=>{ce(k,1,`${r.extraClass} flex flex-col gap-1`),z!==(z=e(l))&&(t.value=(t.__value=e(l))??"",me(t,e(l)))}),C(o,k),le(),i()}ue(["change","click"]);export{tt as D,et as g};

import{w as h}from"./COnQFo7S.js";import{a as u,j as i}from"./BKtatTih.js";import{f as w,d as C}from"./CMvIGskt.js";const m=5*60*1e3,l=h({}),d=h({status:"stand-by",message:"stand by",fetchStartMs:0,fetchEndMs:0}),f=(t,a)=>`${t}-${a}`.toLowerCase(),M=t=>{const a=f(t.letterPair,t.type);l.update(s=>(s[a]={...t,fetchedAtMs:Date.now()},s))},p=async(t="default")=>{const a=Date.now();try{d.set({status:"loading",message:"loading",fetchStartMs:a,fetchEndMs:0});const s=await u(i("flash-cards"),{cache:t});if(!s)return{};if(!s.ok&&s.status!==401)return console.warn("couldn't get flash cards because:",s.status,s.statusText),d.set({status:"error",message:`couldn't get flash cards because ${s.status}, ${s.statusText}`,fetchStartMs:a,fetchEndMs:Date.now()}),{};const n=await s.json();if(!Array.isArray(n))return d.set({status:"error",message:"didn't receive an array",fetchStartMs:a,fetchEndMs:Date.now()}),{};const e={},o=Date.now();for(let c=0;c<n.length;c++){const r=w.safeParse(n[c]);if(r.success){const y=f(r.data.letterPair,r.data.type);e[y]={...r.data,fetchedAtMs:o}}}return l.set(e),d.set({status:"loaded",message:"loaded",fetchStartMs:a,fetchEndMs:Date.now()}),e}catch(s){console.error("error when fetching letter pairs",s),d.set({status:"error",message:`error when fetching letter pairs: ${s}`,fetchStartMs:a,fetchEndMs:Date.now()})}return{}};p("no-store");let g={};l.subscribe(t=>{g=t});const D=async(t,a,s)=>{const n=f(t,a),e=g[n];if(e&&Date.now()-e.fetchedAtMs<m)return e;try{const o=await u(i("flash-cards",t),{cache:"no-store",signal:s});if(!o||!o.ok)return e;const c=await o.json(),r=w.safeParse(c);if(r.success)return M(r.data),r.data}catch(o){console.error("e",o)}},S=(t,a,s)=>{const n=f(t,a),e=s[n];return e||C(t,a)},E=(t,a)=>Object.values(a).filter(s=>s.type===t);export{p as a,S as b,d as c,l as f,E as g,D as l,M as u};

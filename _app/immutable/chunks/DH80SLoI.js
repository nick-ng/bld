import{z as $,a as J,b as B}from"./WMr84jBD.js";import{w as C}from"./BpmZ3ked.js";import{a as x,j as _}from"./B_Hhx7_u.js";import{f as y,a as v}from"./ChvGfjHK.js";import{p as F,c as T,g as u,aM as Z,r as z,t as M,a as q}from"./C5K1Yg5B.js";import{s as K}from"./CliCnMxv.js";import{i as Q}from"./DaHJMf7G.js";import{e as V}from"./BVS0q2To.js";import{s as A}from"./Bqkc9qf9.js";import{s as X}from"./DcH0Rxn3.js";import{s as Y}from"./CfrceTM-.js";import{p as ee}from"./C6H1YX2b.js";const I=$.array(J),P=$.array(B),N=C({}),c=C({status:"empty",source:"empty",message:"stand by",fetchStartMs:0,fetchEndMs:0}),R=s=>{N.update(t=>(s.forEach(e=>{t[e.speffz_pair]?t[e.speffz_pair]={...t[e.speffz_pair],...e}:t[e.speffz_pair]={algorithms:{},...e}}),t))},L=s=>{N.update(t=>(s.forEach(e=>{t[e.speffz_pair]||(t[e.speffz_pair]={speffz_pair:e.speffz_pair,words:"",image:"",sm2_n:0,sm2_ef:2.5,sm2_i:0,is_public:!1,last_review_at:new Date(0),next_review_at:new Date,algorithms:{}}),t[e.speffz_pair].algorithms[e.buffer]=e}),t))},te=async()=>{let s=!0,t=0;for(let e=0;e<20;e++){if(!s)return;try{const p=await(await x(`${_("mnemonic")}?offset=${t}`)).json(),r=I.safeParse(p);if(!r.success){console.error("error: unexpected mnemonic response",r.error),s=!1;break}R(r.data),r.data.length<50&&(s=!1),t=t+r.data.length}catch(a){console.error("error when fetching mnemonics",a),s=!1;break}}s&&alert("Not enough loops to load all mnemonics")},se=async()=>{let s=!0,t=0;for(let e=0;e<100&&s;e++)try{const p=await(await x(`${_("algorithm")}?offset=${t}`)).json(),r=P.safeParse(p);if(!r.success){console.error("error: unexpected algorithm response",r.error),s=!1;break}L(r.data),r.data.length<50&&(s=!1),t=t+r.data.length}catch(a){console.error("error when fetching algorithms",a),s=!1;break}s&&alert("Not enough loops to load all algorithms")};async function ae(s=!1){c.update(t=>({...t,status:s?"loading":"reloading",source:"server",message:"Loading...",fetchStartMs:Date.now()})),await te(),await se(),c.update(t=>({...t,status:"loaded",source:"server",message:"Done",fetchEndMs:Date.now()}))}ae(!0);const be=async(s,t=!1)=>{c.update(e=>({...e,status:"saving",source:"cache",message:"",fetchStartMs:Date.now()}));try{const e=await x(_("/mnemonic"),{method:t?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!e||!e.ok)return c.update(n=>({...n,status:"error",message:"Error",fetchEndMs:Date.now()})),s.speffz_pair;if(!e.headers.get("Content-Type")?.toLowerCase()?.includes("application/json"))return c.update(n=>({...n,status:"error",message:"Error, unexpected content type",fetchEndMs:Date.now()})),s.speffz_pair;const p=await e.json(),r=I.safeParse(p);if(!r.success)return console.error("error, unexpected response when saving mnemonic",r.error),c.update(n=>({...n,status:"error",message:"Error, unexpected response when saving mnemonic",fetchEndMs:Date.now()})),s.speffz_pair;R(r.data),c.update(n=>({...n,status:"loaded",source:"server",message:"",fetchEndMs:Date.now()}))}catch(e){return console.error("error saving mnemonic",e),s.speffz_pair}},xe=async(s,t=!1)=>{const e=`${s.buffer}:${s.speffz_pair}`;c.update(a=>({...a,status:"saving",source:"cache",message:"",fetchStartMs:Date.now()}));try{const a=await x(_("/algorithm"),{method:t?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a||!a.ok)return c.update(i=>({...i,status:"error",message:"Error",fetchEndMs:Date.now()})),e;if(!a.headers.get("Content-Type")?.toLowerCase()?.includes("application/json"))return c.update(i=>({...i,status:"error",message:"Error, unexpected content type",fetchEndMs:Date.now()})),e;const r=await a.json(),n=P.safeParse(r);if(!n.success)return console.error("error, unexpected response when saving algorithm",n.error),c.update(i=>({...i,status:"error",message:"Error, unexpected response when saving algorithm",fetchEndMs:Date.now()})),e;L(n.data),c.update(i=>({...i,status:"loaded",source:"server",message:"",fetchEndMs:Date.now()}))}catch(a){return console.error("error saving mnemonic",a),e}};var re=y('<div class="absolute top-0 right-0 bottom-0 left-0 m-auto flex flex-row items-center justify-center text-9xl leading-none break-keep"> </div>'),oe=y('<div class="relative h-full flex-grow overflow-hidden"></div>'),ne=y('<img class="flex-shrink object-contain"/>'),ie=y('<span class="text-3xl">No Image</span>'),ce=y("<div><!></div>");function Ee(s,t){F(t,!0);let e=ee(t,"imageUri",3,"");const a=2,p=10,r=o=>o.startsWith("blob:")||o.startsWith("/")?o:_("images",o),n=o=>o.replace(/\.emoji$/,"").split(":").map((m,d,b)=>{const l=m.split("");let g="",h=0,E=0,j=0,k=0,S=0;for(let w=0;w<l.length;w++){const D=l[w];switch(D){case"+":{h=h+p;break}case"-":{h=h-p;break}case"^":{E=E+a;break}case">":{k=k+a;break}case"v":{j=j+a;break}case"<":{S=S+a;break}default:g=`${g}${D}`}}return{emoji:g,sizeAdjustment:h,opacity:(b.length-d)/b.length,padding:[j,S,E,k].map(w=>`${w*a}px`).join(" ")}});var i=ce(),O=T(i);{var W=o=>{var f=oe();V(f,23,()=>n(e()),(m,d)=>`${d}-${m.emoji}-${m.padding}`,(m,d,b)=>{var l=re(),g=T(l,!0);z(l),M(h=>{Y(l,h),K(g,u(d).emoji)},[()=>`z-index: ${n(e()).length-u(b)}; font-size: ${128+u(d).sizeAdjustment}px;opacity: ${u(d).opacity};padding: ${u(d).padding};`]),v(m,l)}),z(f),v(o,f)},G=Z(()=>e().endsWith(".emoji")),U=o=>{var f=ne();M(m=>{A(f,"src",m),A(f,"alt",t.alt)},[()=>r(e())]),v(o,f)},H=o=>{var f=ie();v(o,f)};Q(O,o=>{u(G)?o(W):e()?o(U,1):o(H,!1)})}z(i),M(o=>X(i,1,o),[()=>`flex h-64 w-64 flex-row justify-center ${!e()||e().endsWith(".emoji")?"items-center":"items-stretch"}`]),v(s,i),q()}export{Ee as I,c as a,be as b,ae as f,N as l,xe as s};

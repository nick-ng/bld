import{w as S}from"./BpmZ3ked.js";import{U as u,P as p,I as l,A as f}from"./CEuvCyUC.js";import{a as d,j as T}from"./B_Hhx7_u.js";const t=S({isUserAuthenticated:!1,isGuest:!1,username:"",password:"",accessToken:"",accessTokenExpiry:0,isAuthenticating:!1}),c=(s,a)=>{typeof a=="string"&&localStorage.getItem(s)!==a&&localStorage.setItem(s,a)},g=s=>typeof s!="string"?0:parseInt(s.split(":")[0]||"0",10)*1e3;{const s=localStorage.getItem(u);s&&t.update(e=>({...e,username:s}));const a=localStorage.getItem(p);if(a&&t.update(e=>({...e,password:a})),localStorage.getItem(l)?.toLowerCase()==="yes")t.update(e=>({...e,isGuest:!0,isUserAuthenticated:!1}));else{const e=localStorage.getItem(f)||"",i=g(e);e&&i<Date.now()?t.update(o=>({...o,accessToken:e,accessTokenExpiry:i,isUserAuthenticated:!0})):(t.update(o=>({...o,isAuthenticating:!0})),d(T("/login"),{method:"POST"}).then(o=>{if(o.ok){const r=o.headers.get("x-access-token"),n=g(r);r&&n&&t.update(E=>({...E,accessToken:r,accessTokenExpiry:n,isUserAuthenticated:!0,isAuthenticating:!1}))}else console.error("error during login",o),t.update(r=>({...r,isAuthenticating:!1}))}))}t.subscribe(e=>{c(u,e.username),c(p,e.password),c(f,e.accessToken),c(l,e.isGuest?"yes":"no")})}export{t as a,g as p};

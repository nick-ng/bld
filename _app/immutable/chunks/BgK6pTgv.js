import{w as h,g as S}from"./COnQFo7S.js";import{g as k}from"./BZ9uxqYJ.js";import{u as Q}from"./9_MIyRC0.js";import{o as C,f as T}from"./CMvIGskt.js";import{C as D,a as z,b as R}from"./CzRjdjXF.js";import{a as w,j as E,s as _}from"./BKtatTih.js";const m=h([]),y=h("normal"),A=()=>{localStorage.setItem(R,Date.now().toString())},L=()=>{try{const e=localStorage.getItem(R);if(!e)return;const s=parseInt(e,10),i=S(C).leitnerQuizCooldownHours*60*60*1e3;if(Date.now()-s>i)return;const r=localStorage.getItem(D);if(!r)return;const l=JSON.parse(r);m.set(l)}catch(e){console.error("error when retrieving quiz",e)}try{y.set(localStorage.getItem(z)||"normal")}catch(e){console.error("error when retrieving quiz type",e)}};L(),m.subscribe(e=>{localStorage.setItem(D,JSON.stringify(e))}),y.subscribe(e=>{localStorage.setItem(z,e)});const j=async(e,s,i=!1)=>{A(),setTimeout(()=>{let u=!1;m.update(g=>{const o=g.filter(f=>f!=e);return!i&&o.length===0&&(u=!0),o}),u&&k("/flash-cards/summary")});const r=await w(E("quiz",e),{method:"PATCH",body:s});if(!r)return;const l=await r.json(),a=T.safeParse(l);a.success?Q(a.data):console.error("wrong",l)},d={};for(let e=0;e<10;e++)d[e.toString()]=[e%10,(e+2)%10,(e+5)%10,(e+9)%10].map(s=>s.toString(10));const P=e=>{let s=e;e>9&&(s=e%10);const i=[];for(let r=0;r<10;r++)d[r.toString()].includes(s.toString())&&i.push(r.toString());return i},v=(e,s)=>d[`${e}`]?.[3]===s.toString(),b=e=>{const s=e.split(";").map(a=>a.trim()).find(a=>a.startsWith("L:"));if(!s)return{leitnerDeck:"S",leitnerAgeDays:0};const i=s.split(":"),r=i[1];let l=0;if(i[1]==="R"&&i.length===3){const a=i[2].split("-");a.length<3&&a.push("28");const u=new Date(a.join("-"));l=(Date.now()-u.valueOf())/(1e3*60*60*24)}return{leitnerDeck:r,leitnerAgeDays:l}},B=e=>{const{flashCardArray:s,sessionNumber:i,minStandBy:r,minRetired:l,retiredMaxAgeDays:a}=e,u=s.map(t=>({...t,...b(t.tags)})),g=P(i),o=u.filter(t=>!!(t.leitnerDeck==="C"||g.includes(t.leitnerDeck))).map(t=>t.letterPair),f=u.filter(t=>t.leitnerDeck==="S").sort((t,n)=>t.memoConfidence!==n.memoConfidence?t.memoConfidence-n.memoConfidence:t.lastQuizUnix-n.lastQuizUnix),p=u.sort((t,n)=>t.lastQuizUnix-n.lastQuizUnix).filter(t=>t.leitnerDeck==="R"&&(t.lastQuizUnix<Date.now()/1e3-60*60*24*10||t.leitnerAgeDays>=10));if(f.length>0){if(o.length<r*2){const t=S(C);for(let n=0;n<(t.leitnerBonusStandby||0);n++){const c=f.shift();if(c)o.push(c.letterPair);else break}for(let n=0;n<(t.leitnerBonusRetired||0);n++){const c=p.shift();if(c)o.push(c.letterPair);else break}}if(o.length<r){const t=r-o.length;o.push(...f.slice(0,t).map(n=>n.letterPair))}}if(o.length<l){const t=l-o.length,n=p.filter(c=>c.leitnerDeck==="R"&&c.leitnerAgeDays>a).map(c=>c.letterPair);o.push(...n.slice(0,t))}return _(o)};export{y as a,b as g,v as i,d as l,B as m,j as p,m as q,A as t};
